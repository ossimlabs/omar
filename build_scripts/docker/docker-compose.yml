version: '2'
services:
  o2-base:
    build: ./o2-base
    container_name: o2-base
    image: radiantbluetechnologies/o2-base
  # postgresdb:
  #   container_name: db_container
  #   environment:
  #     POSTGRES_PASSWORD: abc123
  #     POSTGRES_USER: postgres_user
  #     POSTGRES_DB: omar_prod
  #   image: postgres:latest
    #image: radiantbluetechnologies/o2-db
  o2-db:
    container_name: o2-db
    build: ./o2-db
    environment:
      POSTGRES_PASSWORD: abc123
      POSTGRES_USER: postgres_user
      POSTGRES_DB: omar_prod
    image: radiantbluetechnologies/o2-db
  # wmts:
  #   build: ./wmts-app
  #   container_name: o2-wmts
  #   environment:
  #     DBHOST: postgresdb
  #     DBPORT: :5432
  #     DBNAME: omar_prod
  #     DBUSER: postgres_user
  #     DBPASS: abc123
  #     WFSSERVER: o2.ossim.org/o2
  #     WFSPORT: ""
  #     WMSSERVER: o2.ossim.org/o2
  #     WMSPORT: ""
  #     FOOTPRINTS: o2.ossim.org/o2
  #     FOOTPRINTSPORT: ""
  #   ports:
  #     - "5000:8080"
  #   links:
  #     - postgresdb
  #   image: radiantbluetechnologies/wmts
  #   depends_on:
  #     - o2-base
  #     - postgresdb
  sqs:
    build: ./sqs-app
    container_name: o2-sqs
    environment:
      AWSDNS: sqs.us-east-1.amazonaws.com
      AWSQUEUEPATH: 320588532383/avro-tst
      WAIT_TIME_SECONDS: 20
      NUMBER_OF_MESSAGES: 1
      POLLING_INTERVAL_SECONDS: 10
      DESTINATION_TYPE: stdout
      DESTINATION_POST_END_POINT: o2-avro
      DESTINATION_POST_END_POINT_PORT: :8080
      DESTINATION_POST_FIELD: message
    volumes:
      # Modify the path below to reflect your
      # AWS credentials location. Example:
      #- /Users/adrake/.aws:/root/.aws
      - /Users/<yourusername>/.aws:/root/.aws
    ports:
      - "5000:8080"
    image: radiantbluetechnologies/o2-sqs
    depends_on:
      - o2-base
  # avrodb:
  #   environment:
  #     POSTGRES_PASSWORD: abc123
  #     POSTGRES_USER: avro
  #     POSTGRES_DB: omar_prod
  #   image: postgres:latest
  avro:
    build: ./avro-app
    container_name: o2-avro
    environment:
      DBHOST: o2-db
      DBPORT: :5432
      DBNAME: omar_prod
      DBUSER: postgres_user
      DBPASS: abc123
      #ADDRASTERENDPOINTURL: 10.0.10.181
      ADDRASTERENDPOINTURL: o2-stager
      ADDRASTERENDPOINTPORT: :8080
    volumes:
      # Mount the data directory locally to the container
      - /Users/Shared/data:/data
    ports:
      - "5001:8080"
    links:
      - o2-db
    image: radiantbluetechnologies/o2-avro
    depends_on:
      - o2-base
      - o2-db
  stager:
    build: ./stager-app
    container_name: o2-stager
    environment:
      DBHOST: o2-db
      DBPORT: :5432
      DBNAME: omar_prod
      DBUSER: postgres_user
      DBPASS: abc123
    volumes:
      # Mount the data directory locally to the container
      - /Users/Shared/data:/data
    ports:
      - "5002:8080"
    links:
      - o2-db
    image: radiantbluetechnologies/o2-stager
    depends_on:
      - o2-base
      - o2-db
